package com.app.Weather.service;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;

import com.app.Weather.beans.Weather;
import com.app.Weather.beans.WeatherInsight;
import com.app.Weather.repository.WeatherRepository;

public class WeatherService {

    @Autowired
    private WeatherRepository weatherRepository; 

    public List<WeatherInsight> getWeatherInsight(Double lon, Double lat, String condition) {
        // Logic to query the database and process weather data
        List<Weather> weatherData = weatherRepository.findByLongitudeAndLatitude(lon, lat);
        return processWeatherData(weatherData, condition);
    }

    private List<WeatherInsight> processWeatherData(List<Weather> weatherData, String condition) {
        List<WeatherInsight> insights = new ArrayList<>();
        for (Weather data : weatherData) {
            boolean metCondition = false;
            if (condition.equals("veryHot")) {
                metCondition = data.getTemperature() > 30;
            } else if (condition.equals("rainyAndCold")) {
                metCondition = data.getTemperature() < 10 && data.getPrecipitation() > 0.5;
            }
            insights.add(new WeatherInsight(data.getForecastTime(), metCondition));
        }
        return insights;
    }
}
